<!DOCTYPE html>
<html lang="en">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>2.1 ESPRESSObin Router</title>
  <meta name="description" content="Design, build, and stewardship of the participatory network">

	<link rel="icon" href="/meshnet/assets/images/favicon.ico">
  <link rel="canonical" href="https://dweb-camp-2019.github.io/meshnet/2.1-espressobin-router.html">

	<link rel="stylesheet" href="/meshnet/assets/css/docs.css">

</head>

	<body>
		<div class="wrapper">
			<sidebar class="sidebar" id="sidebar">
	<div class="sidebar-mobile">
		<img src="/meshnet/assets/images/menu.svg" class="menu-icon" id="menu" />
		<img src="/meshnet/assets/images/close.svg" class="close-icon" id="close" />
	</div>
	<div class="search">
	<input type="text" class="search-input" id="search-input" placeholder="Type to search" />
</div>

	<div class="sidebar-main">
		<ul class="navigation" id="navigation">																						<li>				<a class="" href="/meshnet/">					1.0 Project Overview				</a>			</li>								<li>				<a class="" href="/meshnet/2.0-network-design.html">					2.0 Network Design				</a>			</li>								<li>				<a class="active" href="/meshnet/2.1-espressobin-router.html">					2.1 ESPRESSObin Router				</a>			</li>								<li>				<a class="" href="/meshnet/2.2-vlan-managed-switch.html">					2.2 VLAN Managed Switch				</a>			</li>								<li>				<a class="" href="/meshnet/2.3-point-to-point-mesh-radios.html">					2.3 Point-to-Point Mesh Radios				</a>			</li>								<li>				<a class="" href="/meshnet/2.4-access-point-radios.html">					2.4 Access Point Radios				</a>			</li>								<li>				<a class="" href="/meshnet/2.5-client-poe-switches.html">					2.5 Client PoE Switches				</a>			</li>								<li>				<a class="" href="/meshnet/3.0-social-experience.html">					3.0 Social Experience				</a>			</li>								<li>				<a class="" href="/meshnet/3.1-collaborative-planning.html">					3.1 Collaborative Planning				</a>			</li>								<li>				<a class="" href="/meshnet/3.2-network-stewards.html">					3.2 Network Stewards				</a>			</li>								<li>				<a class="" href="/meshnet/3.3-incident-response.html">					3.3 Incident Response				</a>			</li>								<li>				<a class="" href="/meshnet/3.4-local-services.html">					3.4 Local Services				</a>			</li>								<li>				<a class="" href="/meshnet/3.5-retrospective.html">					3.5 Retrospective				</a>			</li>								<li>				<a class="" href="/meshnet/4.0-planning-notes.html">					4.0 Planning Notes				</a>			</li>								<li>				<a class="" href="/meshnet/4.1-client-device-roaming.html">					4.1 Client Device Roaming				</a>			</li>								<li>				<a class="" href="/meshnet/4.2-babel-wireguard-mesh.html">					4.2 Babel + WireGuard Mesh				</a>			</li>								<li>				<a class="" href="/meshnet/4.3-site-survey.html">					4.3 Site Survey				</a>			</li>								<li>				<a class="" href="/meshnet/4.4-planning-questions.html">					4.4 Planning Questions				</a>			</li>								<li>				<a class="" href="/meshnet/5.0-additional-resources.html">					5.0 Additional Resources				</a>			</li>								<li>				<a class="" href="/meshnet/5.1-application-testnet.html">					5.1 Application Testnet				</a>			</li>								<li>				<a class="" href="/meshnet/5.2-hardware-inventory.html">					5.2 Hardware Inventory				</a>			</li>								<li>				<a class="" href="/meshnet/5.3-graphic-assets.html">					5.3 Graphic Assets				</a>			</li>								<li>				<a class="" href="/meshnet/gallery/2019/">					5.4 Photo Gallery				</a>			</li>			</ul>

		<ul id="search-results" class="navigation"></ul>

	</div>
</sidebar>

			<main class="content">
				<div class="inner">
					<h2 id="21-espressobin-router">2.1 ESPRESSObin Router</h2>

<p>The router is responsible for three things:</p>

<ol>
  <li>Distribute IP addresses to wired and wireless client devices on the LAN</li>
  <li>Distribute routes to its LAN across the mesh network using Babel</li>
  <li>Route IP packets across the mesh network using Babel</li>
</ol>

<p>It is the central point of each node where all other devices are connected to.</p>

<p><img src="images/espressobin.jpg" alt="espressobin" /></p>

<h3 id="espressobin-sbud102-v5">ESPRESSObin SBUD102 V5</h3>

<p>We will configure the ESPRESSObin board so <code>wan</code> is used to connect point-to-point mesh radios, and <code>lan0</code> and <code>lan1</code> are bridged as <code>lan</code> for the local wired and wireless network:</p>

<pre><code>    +-ESPRESSOBIN---------+P+-+
    |                      O  |
    |                      W  |
    |                      E  |
    |      L     L     W   R  |
    |      A     A     A      |
    |    +-N-+ +-N-+ +-N-+    |
    +----| 1 |-| 0 |-|   |----+
         +---+ +---+ +---+
</code></pre>

<ol>
  <li>
    <p>Using your computer, <a href="http://wiki.espressobin.net/tiki-index.php?page=Serial+connection+-+Linux">connect via serial interface</a> to the ESPRESSObinâ€™s micro-USB port and run something like <code>minicom</code> on your computer to update the boot script (you probably need to paste a few lines at a time and make sure there are no spaces before and after each line):</p>

    <pre><code> env default -a
 setenv fdt_addr 0x6000000
 setenv kernel_addr 0x7000000
 setenv loadaddr 0x8000000
 setenv initrd_size 0x2000000
 setenv initrd_addr 0x1100000
 setenv scriptaddr 0x6d00000
 setenv initrd_image uInitrd
 setenv boot_targets 'usb sata mmc1 mmc0'
 setenv boot_prefixes '/ /boot/'
 setenv bootcmd_mmc0 'setenv devnum 0; setenv boot_interface mmc; run scan_dev_for_boot;'
 setenv bootcmd_mmc1 'setenv devnum 1; setenv boot_interface mmc; run scan_dev_for_boot;'
 setenv bootcmd_sata 'setenv devnum 0; scsi scan; scsi dev 0; setenv boot_interface scsi; run scan_dev_for_boot;'
 setenv bootcmd_usb 'setenv devnum 0; usb start;setenv boot_interface usb; run scan_dev_for_boot;'
 setenv bootcmd 'for target in ${boot_targets}; do run bootcmd_${target}; done'
 setenv scan_dev_for_boot 'for prefix in ${boot_prefixes}; do echo ${prefix};run boot_a_script; done'
 setenv boot_a_script 'ext4load ${boot_interface} ${devnum}:1 ${scriptaddr} ${prefix}boot.scr;source ${scriptaddr};'
 saveenv
</code></pre>

    <p>then power off the board by disconnecting both the power and the mirco-USB port</p>
  </li>
  <li>
    <p>Using your computer, flash SD card with <a href="https://www.armbian.com/espressobin/">Armbian for ESPRESSObin</a>, then insert it into the ESPRESSObin with Internet access through one of its ethernet ports, then power on (never connect two ESPRESSObin devices to the same network until after you run this install script, the ethernet interface on all devices have the same MAC address and it will packet storm your network, nobody wants that)</p>
  </li>
  <li>
    <p>Login as <code>root</code> / <code>1234</code> then run <a href="https://github.com/dweb-camp-2019/meshnet/blob/master/prodnet/espressobin/install">espressobin/install</a> and go through the first-run menus.</p>
  </li>
  <li>
    <p>Figure out what type of node this will be:</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: left">Type</th>
          <th style="text-align: left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: left"><code>edge</code></td>
          <td style="text-align: left">Node with only one <em>Point-to-point Mesh Radio</em></td>
        </tr>
        <tr>
          <td style="text-align: left"><code>relay</code></td>
          <td style="text-align: left">Node with multiple <em>Point-to-point Mesh Radios</em> and relays traffic for other nodes</td>
        </tr>
        <tr>
          <td style="text-align: left"><code>gateway</code></td>
          <td style="text-align: left">Node that routes the local network to the Internet</td>
        </tr>
      </tbody>
    </table>

    <p>then run with a <code>TYPE</code> from above and a <code>NODE_ID</code> between 0 to 99:</p>

    <pre><code> # wget https://raw.githubusercontent.com/dweb-camp-2019/meshnet/master/prodnet/espressobin/install
 # chmod +x install
 # ./install TYPE NODE_ID
</code></pre>
  </li>
</ol>

<p><em>The ESPRESSObin V5 has been discontinued and became unavailable weeks before DWeb Camp 2019. The ESPRESSObin V7 can be used in place of the V5.</em></p>


				</div>
			</main>
		</div>
		<script src="/meshnet/assets/js/zepto.min.js"></script>
<script src="/meshnet/assets/js/lunar.min.js"></script>
<script src="/meshnet/assets/js/prism.min.js"></script>
<script src="/meshnet/assets/js/database.js"></script>
<script src="/meshnet/assets/js/search.js"></script>
<script src="/meshnet/assets/js/mobile-navigation.js"></script>

	</body>
</html>
